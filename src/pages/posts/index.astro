---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";
import Layout from "../../layouts/Layout.astro";
import { formatDate } from "../../lib/utils";

// 获取内容集合并按日期降序排列
const collection = await getCollection("posts");
const posts: CollectionEntry<"posts">[] = collection.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// 将文章按年份分组
const postsByYear: Record<number, CollectionEntry<"posts">[]> = posts.reduce(
  (acc, post) => {
    const year = new Date(post.data.pubDate).getFullYear();
    if (!acc[year]) acc[year] = [];
    acc[year].push(post);
    return acc;
  },
  {} as Record<number, CollectionEntry<"posts">[]>
);

// 按年份降序排列
const sortedYears = Object.entries(postsByYear)
  .sort(([yearA], [yearB]) => Number(yearB) - Number(yearA));
---

<Layout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <main>
    <ul class="flex flex-col gap-6">
      {sortedYears.map(([year, posts]) => (
        <li>
          {/* 年份标题 */}
          <h1 class="mb-4 text-xl font-heading font-bold text-zinc-900 dark:text-zinc-100">{year}</h1>

          <ul class="flex flex-col gap-1.5">
            {posts.map((post) => (
              <li>
                <a
                  href={`/posts/${post.slug}`}
                  class="group flex items-baseline justify-between gap-3
                         opacity-90 hover:opacity-100
                         transition-opacity duration-200 ease-out
                         motion-reduce:transition-none"
                >
                  <span
                    class="transition-colors duration-200 ease-out
                           group-hover:text-orange-700 dark:group-hover:text-blue-300
                           motion-reduce:transition-none"
                  >
                    {post.data.title}
                  </span>

                  <span
                    class="text-nowrap font-mono text-zinc-500
                           transition-colors duration-200 ease-out
                           group-hover:text-orange-700 dark:group-hover:text-blue-300
                           motion-reduce:transition-none"
                  >
                    {formatDate(post.data.pubDate)}
                  </span>
                </a>
              </li>
            ))}
          </ul>
        </li>
      ))}
    </ul>
  </main>
</Layout>
