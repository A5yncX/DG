---
title: 11/12æœˆå°ç»“-ä½è°·
pubDate: 2025-01-15 15:01
description: AsyncXçš„åšå®¢-i18n/Content Aggregation/Programming/Philosophy/Hobbies/i18nå¤šè¯­è¨€/å†…å®¹èšåˆ/ç¼–ç¨‹/å“²å­¦/çˆ±å¥½
tags:
  - é—²è¨€ç¢è¯­
categories:
  - æœˆåº¦å°ç»“
lang: zh
pin: false
---
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/3k1IJYrxcQvm9m7UbITf3d?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

## å‰è¨€
å¯¹æˆ‘ä¸ªäººæ¥è¯´, è¿™2ä¸ªæœˆå¯ä»¥è¯´æ˜¯ä»¤æˆ‘ç—›è‹¦çš„2ä¸ªæœˆäº†, æœ‰å²ä»¥æ¥ç¬¬ä¸€æ¬¡"æŒ‚ç§‘".

30%çš„åŸå› å‡ºåœ¨è¯­è¨€ä¸Š, è¿™é—¨è¯¾éœ€è¦ç†è§£é¢˜ç›®å¹¶åˆ†æ. åç†è®º, æˆ‘ç¼ºä¹è¿™æ–¹é¢çš„å¤ä¹ ç»éªŒ.å¦å¤–40%çš„åŸå› å‡ºåœ¨æˆ‘æ²¡æœ‰ç»™è¿™é—¨è¯¾å¾ˆé«˜çš„é‡è§†, æˆ‘çš„ä½œä¸šæˆç»©å¾ˆé«˜, è½»è§†è€ƒè¯•çš„æ·±åº¦å’Œéš¾åº¦äº†. å‰©ä¸‹30%çš„åŸå› æ˜¯æˆ‘å•æ‰“ç‹¬æ–—äº†. æˆ‘ç»™è¿™é—¨è¯¾ç¨‹ç•™ä¸‹çš„é¢„ä¹ å¤ä¹ æ—¶é—´æ˜¯åˆ«çš„è¯¾ç¨‹çš„çš„1/10ç”šè‡³æ›´å°‘. 

é­é‡å¤±è´¥ä¹Ÿä¸èƒ½æ‰¾å€Ÿå£, è¦æ‰¾åŸå› , æ‰€ä»¥è¿™å­¦æœŸæ‰“ç®—æ‰¾å­¦ä¹ ä¼™ä¼´, å¹¶ä¸”å­¦ä¹ é‡å¿ƒæ”¾åœ¨è¿™é—¨è¯¾ä¸Š.

è¯´èµ·æ¥å¾ˆè½»å·§, å®é™…ä¸Šåœ¨æ•´æ•´1ä¸ªæœˆçš„å‡æœŸä¸­ (12.13è€ƒå®Œ-12.27å‡ºè¿™é—¨è¯¾çš„æˆç»©-1.13å¼€å­¦)æƒ…ç»ªä½è½äº†å¤§åŠä¸ªæœˆ, ä»€ä¹ˆéƒ½æ²¡æœ‰åš, ä¹Ÿä»€ä¹ˆéƒ½æ²¡æœ‰åšå¥½. ä»¿ä½›å›åˆ°äº†æœ¬ç§‘æ—¶å€™è¢«è®ºæ–‡å’Œè€ƒç ”å‹å¾—å–˜ä¸è¿‡æ°”çš„æ—¥å­. åšæ¢¦æƒŠé†’, å‘¼å¸è´¹åŠ²æˆä¸ºå¸¸æ€... ç„¶åå…»æˆäº†ç°åœ¨æ¯å¤©åƒç»´ç”Ÿç´ Dçš„ä¹ æƒ¯. 

## è‹¦ä¸­å¾—ä¹

è°¢è°¢äº²äººå’Œå¥½å‹, åœ¨æˆ‘ä½è½çš„æ—¶å€™å¼€å¯¼æˆ‘å®‰æ…°æˆ‘, è®©æˆ‘ä¸è‡³äºä¸€è¹¶ä¸æŒ¯. å’Œå¥½å‹ä¸€èµ·åœ¨å®¶åƒç«é”…, æ‰“é›ªä»—, æ‰“æ¸¸æˆ. è®©æˆ‘çš„æƒ…ç»ªç¨³å®šäº†å¾ˆå¤š. 

å»IGAä¹°äº†ä¸‰æ–‡é±¼, è‡ªå·±åœ¨å†°ç®±å†»äº†åŠä¸ªæœˆæ¥æ€æ­»å¯„ç”Ÿè™«. åŸºäºå”®å–çš„ä¸‰æ–‡é±¼çš„æ ·å­, æˆ‘å¾—å‡ºäº†ä¸€ä¸ªç»“è®º, å›½å†…çš„ä¸‰æ–‡é±¼éƒ½æ˜¯è¾¾ä¸åˆ°ç”Ÿé£Ÿå“è´¨çš„, å‡ä¸ºå†·å†»æ€æ­»å¯„ç”Ÿè™«åå†æ‹¿å‡ºæ¥å”®å–çš„, è‡ªå·±å†»ä¼šæ›´ä¾¿å®œå’Œå¥åº·.
![åƒå®Œç«Ÿç„¶ä¸ä¼šæ‹‰è‚šå­](https://r2.asyncx.top/2025/01/15/202501151606901.webp)

è¿˜æœ‰æœ€å¤§çš„ä¸€ä¸ªæ”¹å˜å°±æ˜¯é©¾é©¶æŠ€æœ¯, é£é€Ÿå¢é•¿. Montrealè¿ˆå…¥å†¬å­£, ä¸€å‘¨å¯èƒ½æœ‰6å¤©éƒ½æ²¡æœ‰å¤ªé˜³, åœ¨ä½“æ„Ÿæ¸©åº¦å¤§çº¦ä¸º-15â„ƒçš„å¤©æ°”è¿˜æ˜¯å¼€è½¦å‡ºé—¨è´­ç‰©æ›´åˆé€‚. å¶å°”æ¥ä¸Šæœ‹å‹å»è´­ç‰©, ç»å¸¸è¦è·‘é«˜é€Ÿ. äº‰å–è¿™å­¦æœŸè€ƒä¸‹æ¥é©¾ç…§.

## åšå®¢è£…ä¿®
ä»ä¸Šå¹´å¹´åº•å‹é‚»ç«¹å­åœ¨Mastodonè½¬å‘äº†[OpenHeart](https://github.com/dddddddddzzzz/OpenHeart)ç›¸å…³çš„å¸–å­åæˆ‘å°è¯•éƒ¨ç½²äº†ä¸€ä¸‹. å‡ºç°äº†æ— æ³•ä½¿ç”¨çš„é—®é¢˜, è¿‘æ—¥ä»”ç»†æŸ¥æ‰¾åå‘ç°æä¾›çš„`worker.js`å¤šäº†ä¸€æ¬¡ç¼–ç , å¯¼è‡´å‰ç«¯GETå’ŒPOSTçš„åœ°å€å’ŒKVä¸­æ‰€å­˜å‚¨çš„ä¸ä¸€æ ·. åœ¨è¿™é‡Œæä¾›ä¸€äº›å‚è€ƒæ€§çš„å»ºè®®.

Openheartæ•´ä¸ªæµç¨‹ä¸º: å‰ç«¯ä¼ é€’-åç«¯å­˜å‚¨-å‰ç«¯è·å–. å½“åœ¨å‰ç«¯ç‚¹èµå, é€šè¿‡è„šæœ¬(worker.js)åˆ›å»ºç›¸åº”çš„æ•°æ®(KV)è¿›è¡Œå­˜å‚¨, å¹¶é€šè¿‡å‰ç«¯jsæ¥åˆ·æ–°æ˜¾ç¤ºæœ€æ–°çš„ç‚¹èµè®¡æ•°. ç°åœ¨æ¥è¯¦ç»†çš„è¿›è¡Œéƒ¨ç½².
### åç«¯å­˜å‚¨

> æœ¬æ–‡æ•™ç¨‹ä½¿ç”¨Astroå’ŒCloudflare

é¦–å…ˆåœ¨Cloudflareçš„æ§åˆ¶å°åˆ›å»ºä¸€ä¸ªå­˜å‚¨åº“: å­˜å‚¨å’Œæ•°æ®åº“-KV-åˆ›å»º. æ–¹ä¾¿èµ·è§, åå­—å°±å’Œæˆ‘ä¸€æ ·è®¾ç½®ä¸º`KV`å³å¯.
æ¥ä¸‹æ¥åˆ›å»ºCloudflare Workers, å¤åˆ¶ä»£ç åˆ°`worker.js`ä¸­:
```js collapse={1~97}
const instruction = `.^â‹^.
'. .'
  \`
OpenHeart protocol API
`;

export default {
  async fetch(request, env) {
    if (request.method === 'OPTIONS') {
      return new Response(null, { headers });
    }
    if (request.method === 'GET') {
      if (url(request).pathname === '/') {
        return new Response(instruction, { headers });
      } else {
        return handleGet(request, env);
      }
    }
    if (request.method === 'POST') return handlePost(request, env);
  },
};

const headers = {
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Methods": "GET,POST",
  "Access-Control-Max-Age": "86400",
};

function error(text, code = 400) {
  return new Response(text, { headers, status: code });
}

function url(request) {
  return new URL(request.url);
}

function ensureEmoji(emoji) {
  const segments = Array.from(
    new Intl.Segmenter({ granularity: 'grapheme' }).segment(emoji.trim())
  );
  const parsedEmoji = segments.length > 0 ? segments[0].segment : null;

  if (/\p{Emoji}/u.test(parsedEmoji)) return parsedEmoji;
}

// Generate KV keys with single encoding
function generateKey(domain, uid, emoji) {
  const encodedDomain = encodeURIComponent(domain); // Single encoding
  const encodedUid = encodeURIComponent(uid); // Single encoding
  return `${encodedDomain}:${encodedUid}:${emoji}`;
}

async function handleGet(request, env) {
  const [domain, ...uidParts] = url(request).pathname.slice(1).split('/');
  const decodedDomain = decodeURIComponent(domain); // è§£ç 
  const decodedUid = decodeURIComponent(uidParts.join('/')); // è§£ç 
  const prefix = `${encodeURIComponent(decodedDomain)}:${encodeURIComponent(decodedUid)}`; // å•æ¬¡ç¼–ç 
  console.log("GET Prefix:", prefix); // è°ƒè¯•æ—¥å¿—

  const res = await env.KV.list({ prefix });
  const list = {};
  for (const key of res.keys) {
    const value = await env.KV.get(key.name);
    const [, uidDecoded, emoji] = key.name.split(':').map(decodeURIComponent); // è§£ç é”®å€¼
    const obj = list[uidDecoded] || {};
    obj[emoji] = Number(value);
    list[uidDecoded] = obj;
  }

  console.log("GET Response Data:", list); // è°ƒè¯•æ—¥å¿—
  return new Response(
    JSON.stringify(list[decodedUid] || {}),
    { headers: { ...headers, 'Content-Type': 'application/json;charset=UTF-8' } }
  );
}


async function handlePost(request, env) {
  const urlObject = url(request);
  const path = urlObject.pathname.slice(1);
  if (path === '') return error('pathname missing');

  const [domain, ...uidParts] = path.split('/');
  const decodedDomain = decodeURIComponent(domain); // è§£ç 
  const decodedUid = decodeURIComponent(uidParts.join('/')); // è§£ç 
  const emoji = ensureEmoji(await request.text());
  if (!emoji) return error('request body should contain an emoji');

  // Generate the key with single encoding
  const key = generateKey(decodedDomain, decodedUid, emoji);
  console.log("POST Generated Key:", key); // è°ƒè¯•æ—¥å¿—

  const currentCount = Number(await env.KV.get(key) || 0);
  await env.KV.put(key, currentCount + 1);

  return new Response('recorded', { headers });
}
```
åœ¨æ¨é€åå›åˆ°Workerçš„è®¾ç½®ç•Œé¢, ç»‘å®šåˆšåˆšåˆ›å»ºçš„KV, åç§°å‡è®¾ç½®ä¸ºKV.
![](https://r2.asyncx.top/2025/01/15/202501151627013.webp)
å½“æˆ‘ä½¿ç”¨è‡ªå®šä¹‰åŸŸçš„æ—¶å€™å‡ºç°äº†é—®é¢˜, å› æ­¤æˆ‘ä½¿ç”¨äº†é»˜è®¤çš„workers.devåŸŸå.

### å‰ç«¯ä¼ é€’/è·å–
æ¥ä¸‹æ¥å°±æ˜¯å‰ç«¯çš„ä¼ é€’. åœ¨Openheartçš„åè®®ä¸­, ä½ éœ€è¦åœ¨è®¿é—®APIæ—¶æä¾›ä¸€ä¸ªtargetå’Œuid, è¿™ä¸ªtargetå¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦ä¸², äºæ˜¯æˆ‘è®¾ç½®ä¸ºå½“å‰åšæ–‡çš„é“¾æ¥å¹¶å°†uidé»˜è®¤ä¸º`like`.
æˆ‘ä»¬æ¥åˆ†æä¸‹é¢çš„urlæ„æˆ.`https://xxx.workers.dev/xxx.example.com/like`é™¤å»`https://`å, urlè¢«`/`åˆ†æˆäº†3éƒ¨åˆ†, ç¬¬ä¸€éƒ¨åˆ†æ˜¯domain, æ˜¯ä½ è¯·æ±‚çš„ä¸»æœº, ç¬¬äºŒæ˜¯ç›®æ ‡åœ°å€(ä¸»æœºè®°å½•çš„ä½ çš„ç½‘ç«™), ç¬¬ä¸‰å¯ä»¥ç†è§£æˆä¸€ä¸ªè‡ªå®šæ ‡å¿—, éšä¾¿èµ·å, ä¿è¯åœ¨ä»£ç ä¸­ä¸æ”¹åŠ¨å³å¯.
æ‰€ä»¥æ ¹æ®å®˜æ–¹çš„æ–‡æ¡£, å¯ä»¥åœ¨ç»ˆç«¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥è¿›è¡ŒPOST(ç‚¹èµ)å’ŒGET(è·å–ç‚¹èµæ•°)æ“ä½œ, ä½ å¯ä»¥é€šè¿‡æ­¤æ­¥éª¤æµ‹è¯•æ˜¯å¦èƒ½æ­£å¸¸ä½¿ç”¨:
```bash
curl -d 'ğŸ’¯' -X POST 'https://xxx.workers.dev/xxx.example.com/like'
recorded%
curl 'https://xxx.workers.dev/xxx.example.com/like'
{"â¤ï¸":1}%
```

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­, ç‰¹æ®Šå­—ç¬¦, ä¾‹å¦‚`:/`ä¼šæ ¹æ®worker.jsè®¾ç½®æ¥å½±å“å¯¹KVçš„å­˜å‚¨. å› æ­¤éœ€è¦å¯¹urlç¼–ç ä¸€æ¬¡æ¥è½¬æ¢è¿™äº›ç‰¹æ®Šå­—ç¬¦. ä¸‹é¢çš„ä»£ç æ˜¯astroæ–‡ä»¶çš„ä»£ç , å°†å…¶æ”¾åœ¨ä½ æƒ³è®©ç‚¹èµæŒ‰é’®åœ¨çš„åœ°æ–¹å³å¯.
```html
---
// Get current URL dynamically
const currentUrl = Astro.url.toString();
---
<script src="https://unpkg.com/open-heart-element" type="module"></script>
<div class="like">
<open-heart href={`https://xxx.workers.dev/${currentUrl}/like`} data-umami-event="Like" emoji="â¤ï¸">â¤ï¸
</open-heart>
</div>
<script>
	window.customElements.whenDefined('open-heart').then(() => {
	  for (const oh of document.querySelectorAll('open-heart')) {
		oh.getCount()
	  }
	})
	// refresh component after click
	window.addEventListener('open-heart', e => {
	  e && e.target && e.target.getCount && e.target.getCount()
	})
</script>
```
è¿™æ ·çš„è¯·æ±‚å’Œå­˜å‚¨å°±ä¿æŒä¸€è‡´äº†, ä½ å¯ä»¥é€šè¿‡å¼€å‘è€…å·¥å…·æ¥ç¡®è®¤è¿™ä¸€ç‚¹
![](https://r2.asyncx.top/2025/01/15/202501151637263.webp)
![](https://r2.asyncx.top/2025/01/15/202501151637373.webp)

æœ€åå°±æ˜¯å‰ç«¯æ ·å¼, ç”±äºæˆ‘çš„åŸºäºbenjiçš„äºŒæ¬¡ä¿®æ”¹, è¿™æ˜¯[benjiçš„æ–‡ç« é“¾æ¥](https://www.benji.dog/articles/interactions-or-reactions/), å¯ä»¥è‡ªè¡Œè®¿é—®è·å–.

## ä¹¦å½±éŸ³æ¸¸
é¢“åºŸçš„è¿™æ®µæ—¶é—´éƒ½ç”¨æ¥çœ‹å°è¯´äº†, é‡æ–°çœ‹äº†ä¸€éé¾™æ—.

++tv/season/7SFK34YjPavk4GINN3OeGW++

ç¬¬ä¸ƒé›†çš„æŠ½å¸§è®©æˆ‘æ„Ÿåˆ°æƒŠè‰³, å°±æ˜¯æœ€åçš„ç»“å°¾ç•¥æ˜¾ä»“ä¿ƒ, æ°æ–¯é™ªè‘¬çš„åŠ¨æœºæˆ‘æ„Ÿè§‰ä¸æ˜¯å¾ˆæ¸…æ™°.

++game/21J6htiKlo8WgU1CQbfI0N++

åœ£è¯æ—¶å€™å’Œå¤§å®¶ä¸€èµ·ç”¨Switchç©äº†.

++tv/season/2ZgS53uh0au6wUA92UZrWW++

++game/6tNeehHtnETUtptu1nhwzO++

ä¸€éƒ¨ä¸é”™çš„é­”å¹»å²è¯—, åœ¨åˆšå‡ºçš„æ—¶å€™è§‰å¾—åå­—å¥½å¬ä½“éªŒäº†ä¸€ä¸‹, è¢«å†—é•¿çš„ä»»åŠ¡æ‰“æ–­äº†. ç°åœ¨åˆ›æ–°å·é‡æ–°å›å‘è¿‡å®Œäº†å‰§æƒ…, å¾ˆæ£’.